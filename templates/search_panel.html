<!-- templates/search_panel.html -->
<div class="search-panel" style="position: fixed; left: 0; top: 0; width: 300px; height: 100vh; background: white; border-right: 1px solid #dbdbdb; z-index: 1000; padding: 20px; box-shadow: 2px 0 5px rgba(0,0,0,0.1); overflow-y: auto;">

    <!-- Panel sarlavhasi -->
    <h3 style="margin-bottom: 20px; font-size: 18px; font-weight: bold;">Search</h3>

    <!-- Search Input -->
    <div style="position: relative; margin-bottom: 20px;">
        <input type="text" id="searchInput" placeholder="Search" style="
            width: 100%;
            padding: 10px;
            border: 1px solid #dbdbdb;
            border-radius: 4px;
            font-size: 14px;
            outline: none;
        ">
        <span id="clearSearch" style="position: absolute; right: 10px; top: 50%; transform: translateY(-50%); cursor: pointer; color: #777; display: none;">×</span>
    </div>

    <!-- Recent Section -->
    <div style="margin-bottom: 20px;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
            <strong>Recent</strong>
            <a href="#" id="clearAll" style="color: #0095f6; font-size: 14px; text-decoration: none;">Clear all</a>
        </div>

        <!-- Recent Users -->
        <div id="recentUsers">
            {% for user in recent_users %}
            <div class="user-item" style="display: flex; align-items: center; padding: 10px 0; border-bottom: 1px solid #eee;">
                <!-- Avatar -->
                {% if post.owner.image %}
                    <img src="{{ user.image.url }}" alt="{{ user.username }}" style="width: 32px; height: 32px; border-radius: 50%; object-fit: cover; margin-right: 10px;">
                {% else %}
                    <img src="data:image/svg+xml;charset=UTF-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='32' height='32' viewBox='0 0 24 24' fill='%23ddd'%3E%3Cpath d='M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z'/%3E%3C/svg%3E" 
                        alt="{{ user.username }}" 
                        style="width: 32px; height: 32px; border-radius: 50%; object-fit: cover; margin-right: 10px;">
                {% endif %}
                <!-- Info -->
                <div style="flex-grow: 1;">
                    <div style="font-weight: bold; font-size: 14px;"><a href="/{{ user.username }}/" style="color: inherit; text-decoration: none;">{{ user.username }}</a></div>
                    <div style="font-size: 12px; color: #777;">{{ user.first_name }} {{ user.last_name }} • {{ user.followers.count }} followers</div>
                </div>

                <!-- Follow Button -->
                {% if request.user != user %}
                    <button class="follow-btn" data-username="{{ user.username }}" style="padding: 5px 10px; border: 1px solid #dbdbdb; border-radius: 4px; background: white; font-size: 12px; cursor: pointer;">Follow</button>
                {% endif %}
            </div>
            {% empty %}
            <p style="color: #777; font-size: 14px; text-align: center;">No recent users.</p>
            {% endfor %}
        </div>
    </div>

    <!-- Close Button -->
    <div style="position: fixed; bottom: 20px; left: 20px; width: calc(100% - 40px);">
        <button id="closeSearchPanel" style="width: 100%; padding: 10px; background: #fafafa; border: 1px solid #dbdbdb; border-radius: 4px; font-size: 14px; cursor: pointer;">Close</button>
    </div>

</div>

<script>
// Search input
const searchInput = document.getElementById('searchInput');
const clearSearch = document.getElementById('clearSearch');

searchInput.addEventListener('input', function() {
    const query = this.value.trim().toLowerCase();
    if (query.length > 0) {
        clearSearch.style.display = 'block';
    } else {
        clearSearch.style.display = 'none';
    }
});

clearSearch.addEventListener('click', function() {
    searchInput.value = '';
    clearSearch.style.display = 'none';
});

// Close button
document.getElementById('closeSearchPanel').addEventListener('click', function() {
    document.querySelector('.search-panel').style.display = 'none';
});

// Follow button (AJAX)
document.querySelectorAll('.follow-btn').forEach(btn => {
    btn.addEventListener('click', function() {
        const username = this.dataset.username;
        fetch(`/follow/${username}/`, {
            method: 'POST',
            headers: {
                'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value,
                'X-Requested-With': 'XMLHttpRequest'
            }
        })
        .then(response => response.json())
        .then(data => {
            if (data.is_following) {
                this.textContent = 'Unfollow';
                this.style.backgroundColor = '#e1306c';
                this.style.color = 'white';
            } else {
                this.textContent = 'Follow';
                this.style.backgroundColor = 'white';
                this.style.color = '#262626';
            }
        });
    });
});
</script>